<title>Chatroom</title>

<head>
    <link rel="stylesheet" href="/styles.css">
    <script>
        function scrollToBottom() {
            const chatContainer = document.getElementById('chatMessages');
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        window.onload = scrollToBottom;
    </script>
</head>

<%- include("templates/header") %>

    <div id="chatMessages" style="overflow-y: auto; max-height: 500px; padding-right: 10px;">
        <% for (let i=0; i < messages.length; i++) { %>
            <% if (i==read_count) { %>
                <div class="new-message-divider">
                    <p>----------------You have <%= num_message_behind %> new messages ----------------</p>
                </div>
                <% } %>

                    <div class="message-item <%= messages[i].user_id === user_id ? 'user-message' : 'other-message' %>">
                        <div class="<%= messages[i].user_id === user_id ? 'user-bg' : 'other-bg' %>"
                            style=" padding: 10px;    border-radius: 8px;">
                            <div class="message-header">
                                <span class="username">
                                    <%= messages[i].username %>
                                </span>
                                <span class="timestamp">
                                    <%= new Date(messages[i].sent_time).toLocaleString('en-US', { month: '2-digit' ,
                                        day: '2-digit' , hour: '2-digit' , minute: '2-digit' , hour12: true }) %>

                                </span>
                            </div>
                            <div class="message-text" style="color: brown;">
                                <%= messages[i].text %>
                            </div>
                            <div class="emoji-wrapper">
                                <%= messages[i].emoji_list %>
                                    <div class="emoji-button-container">
                                        <button>‚ûï</button>
                                        <div class="emoji-menu" id="<%= messages[i].message_id %>">
                                            <form action="/add-reaction" method="POST">
                                                <input type="hidden" name="room_id" value="<%= room_id %>" />
                                                <input type="hidden" name="message_id"
                                                    value="<%= messages[i].message_id %>">
                                                <button type="submit" name="emoji" value="1"
                                                    class="emoji-option">üëç</button>
                                                <button type="submit" name="emoji" value="2"
                                                    class="emoji-option">‚ù§Ô∏è</button>
                                                <button type="submit" name="emoji" value="3"
                                                    class="emoji-option">üòÇ</button>
                                                <button type="submit" name="emoji" value="4"
                                                    class="emoji-option">üòÆ</button>
                                                <button type="submit" name="emoji" value="5"
                                                    class="emoji-option">üò¢</button>
                                            </form>
                                        </div>
                                    </div>

                            </div>
                        </div>
                    </div>

                    <% } %>
                        <div style="height: 40px;clear: both"></div>
    </div>

    <div>
        <div id="chatInput">
            <form action="/sendMessage" method="POST">
                <input type="hidden" name="roomId" value="<%= room_id %>">
                <input type="text" id="messageInput" name="message" placeholder="Type a message..." required>
                <button type="submit">Send</button>
            </form>
        </div>
        <button onclick="window.location.href = '/invite?room_id=<%= room_id %>'">Invite People</button>
        <button onclick="window.location.href ='/members'" style="float: right;">Go Back</button>
    </div>


    <%- include("templates/footer") %>